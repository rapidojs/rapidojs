# Rapido.js v1.1.0 "武库" (The Arsenal) 发布日志

**发布日期**: 2025年1月  
**版本**: v1.1.0  
**代号**: "武库" (The Arsenal)

## 🎯 版本概述

v1.1.0 "武库" 版本是 Rapido.js 的一个重要里程碑版本，引入了企业级的增强依赖注入容器和一系列高级装饰器，为开发者提供了更强大、更灵活的依赖管理能力。

## ✨ 核心新特性

### 🔄 增强的依赖注入容器 (Enhanced DI Container)

全新的增强 DI 容器取代了原有的基础容器，提供了企业级的依赖管理功能：

#### 循环依赖检测与处理
- **自动检测**: 智能检测循环依赖并输出详细警告
- **解决建议**: 提供 `forwardRef()` 等解决方案建议
- **依赖追踪**: 完整的依赖解析路径追踪

```typescript
// 自动检测循环依赖
⚠️  检测到循环依赖: ServiceA -> ServiceB -> ServiceA
建议使用 forwardRef() 来解决循环依赖问题
```

#### 多种依赖作用域支持
- **Singleton**: 单例作用域（默认）
- **Transient**: 瞬态作用域，每次注入创建新实例
- **Request**: 请求级作用域，每个 HTTP 请求内共享实例

#### 懒加载依赖注入
- **延迟实例化**: 只在首次访问时创建实例
- **智能代理**: 透明的代理机制，无需修改业务代码
- **性能优化**: 减少应用启动时间

#### 条件注入
- **环境条件**: 基于环境变量的条件注入
- **配置条件**: 基于配置值的条件注入
- **自定义条件**: 支持自定义条件函数

### 🎨 高级装饰器系统

#### 作用域装饰器
```typescript
@Singleton()        // 单例作用域装饰器
@Transient()       // 瞬态作用域装饰器
@RequestScoped()   // 请求级作用域装饰器
@Scope(DependencyScope.SINGLETON) // 通用作用域装饰器
```

#### 条件注入装饰器
```typescript
@ConditionalOn({ env: 'NODE_ENV', value: 'production' })
@ConditionalOn({ config: 'feature.redis', value: 'true' })
@ConditionalOn({ condition: () => process.platform === 'darwin' })
```

#### 懒加载装饰器
```typescript
@Injectable()
export class MyService {
  constructor(
    @Lazy() private heavyService: HeavyService
  ) {}
}
```

### 🔧 容器接口统一

引入了 `IContainer` 接口，统一了不同容器实现：
- **向后兼容**: 保持与现有代码的兼容性
- **类型安全**: 完整的 TypeScript 类型支持
- **扩展性**: 为未来的容器扩展提供基础

## 🚀 性能改进

### 启动性能优化
- **懒加载**: 减少应用启动时的实例化开销
- **条件注入**: 避免不必要的服务注册
- **智能缓存**: 优化依赖解析缓存机制

### 运行时性能
- **作用域优化**: 不同作用域的性能特化
- **代理优化**: 高效的懒加载代理实现
- **内存管理**: 改进的实例生命周期管理

## 🔄 重大变更 (Breaking Changes)

### 默认容器变更
- **新默认容器**: `EnhancedDIContainer` 现在是默认的 DI 容器
- **向后兼容**: 现有代码无需修改即可使用新容器
- **API 保持**: 公开 API 保持不变

### 类型系统增强
- **新接口**: 引入 `IContainer` 接口
- **类型安全**: 增强的类型检查和推断

## 📚 文档更新

### 新增文档
- **增强的依赖注入容器**: 完整的功能说明和最佳实践
- **高级装饰器指南**: 详细的装饰器使用说明
- **性能优化指南**: 作用域选择和性能考虑

### 更新文档
- **README**: 更新核心特性和示例
- **装饰器文档**: 添加新装饰器的详细说明
- **高级功能**: 整合增强 DI 容器内容

## 🧪 测试覆盖

### 新增测试
- **循环依赖测试**: 完整的循环依赖检测测试
- **作用域测试**: 各种作用域的行为测试
- **懒加载测试**: 懒加载机制的测试
- **条件注入测试**: 条件注入逻辑测试

### 测试统计
- **总测试数**: 584 个测试
- **覆盖率**: 90%+ 代码覆盖率
- **测试文件**: 40 个测试文件

## 🔧 开发体验改进

### 调试支持
- **详细日志**: 丰富的依赖解析日志
- **警告信息**: 清晰的循环依赖警告
- **错误提示**: 改进的错误信息和建议

### IDE 支持
- **类型提示**: 完整的 TypeScript 类型提示
- **自动完成**: 改进的装饰器自动完成
- **错误检查**: 编译时的类型错误检查

## 📦 依赖更新

### 核心依赖
- **TypeScript**: 继续支持 5.0+
- **Node.js**: 继续支持 18.0+
- **Fastify**: 继续基于 5.x

### 新增依赖
- **reflect-metadata**: 增强的元数据支持
- **事件系统**: 改进的生命周期事件总线

## 🔮 未来规划

### v1.2.0 "数据引擎" 预览
- **TypeORM 集成**: 官方 TypeORM 模块
- **Redis 集成**: 官方 Redis 模块
- **示例项目**: 完整的企业级示例应用

## 🙏 致谢

感谢所有为 v1.1.0 版本做出贡献的开发者和社区成员。特别感谢：

- 核心团队对增强 DI 容器的设计和实现
- 社区反馈和建议
- 测试和文档贡献者

## 📋 完整变更列表

### 新增功能
- ✅ 增强的依赖注入容器 (`EnhancedDIContainer`)
- ✅ 循环依赖检测和警告系统
- ✅ 多种依赖作用域支持 (Singleton/Transient/Request)
- ✅ 懒加载依赖注入 (`@Lazy`)
- ✅ 条件注入装饰器 (`@ConditionalOn`)
- ✅ 作用域装饰器 (`@Scope`, `@Singleton`, `@Transient`, `@RequestScoped`)
- ✅ 统一容器接口 (`IContainer`)
- ✅ 请求级作用域容器
- ✅ 智能懒加载代理
- ✅ 依赖关系追踪器

### 改进功能
- ✅ 默认容器升级为 `EnhancedDIContainer`
- ✅ 改进的错误信息和调试支持
- ✅ 优化的性能和内存使用
- ✅ 增强的类型安全性

### 文档更新
- ✅ 新增增强 DI 容器专门文档
- ✅ 更新装饰器文档
- ✅ 更新 README 和 ROADMAP
- ✅ 更新高级功能文档
- ✅ 新增发布日志

### 测试改进
- ✅ 新增循环依赖测试套件
- ✅ 新增作用域测试
- ✅ 新增懒加载测试
- ✅ 新增条件注入测试
- ✅ 维持 90%+ 测试覆盖率

---

**升级指南**: 由于 v1.1.0 保持了向后兼容性，现有项目可以直接升级而无需修改代码。新功能可以逐步采用。

**下载**: `npm install @rapidojs/core@1.1.0`

**反馈**: 如有问题或建议，请在 [GitHub Issues](https://github.com/rapidojs/rapidojs/issues) 中反馈。